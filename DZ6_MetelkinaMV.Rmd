---
title: "DZ6"
output: html_document
---

## Домашнее задание 6

*Выполнила Метелкина Марина*

**Тема:** расчет выборки при планировании исследования.

**Цель:** научиться рассчитывать выборку для исследований с различными конечными точками.

#### Описание ДЗ

При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

```{r}
# Уровень значимости
alpha <- 0.05

# Значение beta
beta <- 0.2

# Мощность
power <- 0.80

# Ожидаемый Drop-out rate
dropout_rate <- 0.1
```

### Задание 1.
Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20), а разница средних составляет −10%. Клиницисты сообщают нам, что клинически значимая разница составляет 25% ( = 0.25).

```{r}
# Дисперсия
sd <- 0.20

# Разница средних
eps <- 0.1

# Клинически значимая разница
delta <- 0.25
```

```{r}
## Рассчет z-значения для уровня значимости и мощности
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)

# Рассчет размера выборки для каждой группы (n1 = n2) 
n_size <- ((z_alpha_2 + z_beta)^2 * sd^2) / (2 * (delta - abs(eps))^2)

# Определение размера выборки для каждой группы (учитывая drop-out rate)
n_total <- n_size / (1 - dropout_rate)

# Определение общего размера выборки (учитывая оба периода)
n_total_size <- n_total * 2
```

```{r}
# Вывод результатов
cat("Размер выборки для каждой группы n1 = n2:", round(n_size), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total_size), "\n")
```


### Задание 2.

Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница  = -0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата  = 0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет  = 0.85. Соотношение групп равно  = 1.

```{r}
# Клинически значимая разница
delta <- -0.1

# Доля ответов для препаратов 
p2 <- 0.65 # тестовый препарат
p1 <- 0.85 # препарат сравнения

# Соотношение групп
k <- 1
```


```{r}
# Рассчет z-значения для уровня значимости и мощности
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)

# Рассчет размера выборки для каждой группы (n1 = n2)
n_size <- ((((z_alpha_2 + z_beta)^2) * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2) * k

# Определение размера выборки для каждой группы (учитывая drop-out rate)
n_total <- n_size / (1 - dropout_rate)

# Определение общего размера выборки (учитывая оба периода)
n_total_size <- n_total * 2
```


```{r}
# Вывод результатов
cat("Размер выборки для каждой группы n1 = n2:", round(n_total), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total_size), "\n")
```


### Задание 3.

Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0.5).


```{r}
# Отношение рисков
HR <- 2

# Процент пациентов столкнувшихся с заболеванием
d <- 0.8

# Соотношение групп
p1 <- 0.5
p2 <- 0.5
```


```{r}
# Рассчет z-значения для уровня значимости и мощности
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)

# Рассчет размера выборки для каждой группы (n1 = n2)
n_size <- ((z_alpha_2 + z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)

# Определение размера выборки для каждой группы (учитывая drop-out rate)
n_total <- n_size / (1 - dropout_rate)

# Определение общего размера выборки (учитывая оба периода)
n_total_size <- n_total * 2
```

```{r}
# Вывод результатов
cat("Размер выборки для каждой группы n1 = n2:", round(n_total), "\n")
cat("Общий размер выборки (учитывая оба периода):", round(n_total_size), "\n")
```
